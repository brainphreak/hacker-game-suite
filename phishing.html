<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phishing Expedition - The Black Packet</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }
        
        body {
            background-color: #0a0a0a;
            color: #00ff00;
            overflow-x: hidden;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 40, 0, 0.2) 0%, transparent 20%),
                radial-gradient(circle at 90% 60%, rgba(0, 60, 0, 0.2) 0%, transparent 20%),
                radial-gradient(circle at 50% 80%, rgba(0, 30, 0, 0.2) 0%, transparent 20%);
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 1px solid #003300;
            margin-bottom: 30px;
            position: relative;
        }
        
        h1 {
            font-size: 2.5rem;
            text-shadow: 0 0 10px #00ff00;
            margin-bottom: 10px;
            letter-spacing: 3px;
        }
        
        .subtitle {
            color: #00aa00;
            font-size: 1.2rem;
        }
        
        .game-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            background: rgba(0, 20, 0, 0.7);
            padding: 15px;
            border: 1px solid #004400;
            border-radius: 5px;
        }
        
        .stat-box {
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #00ff00;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #00aa00;
        }
        
        .email-container {
            background: rgba(0, 10, 0, 0.8);
            border: 1px solid #003300;
            border-radius: 5px;
            padding: 20px;
            min-height: 400px;
            position: relative;
            overflow: hidden;
        }
        
        .email-header {
            border-bottom: 1px solid #003300;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }
        
        .email-subject {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        
        .email-from {
            color: #00aa00;
            font-size: 1.1rem;
        }
        
        .email-body {
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .email-footer {
            border-top: 1px solid #003300;
            padding-top: 15px;
            color: #008800;
            font-size: 0.9rem;
        }
        
        .actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        button {
            background: rgba(0, 30, 0, 0.8);
            border: 1px solid #00aa00;
            color: #00ff00;
            padding: 12px 25px;
            font-size: 1.1rem;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        button:hover {
            background: rgba(0, 50, 0, 0.8);
            box-shadow: 0 0 10px #00ff00;
        }
        
        #phish-btn {
            border-color: #ff3300;
            color: #ff6666;
        }
        
        #phish-btn:hover {
            box-shadow: 0 0 10px #ff3300;
        }
        
        .result {
            text-align: center;
            margin-top: 20px;
            font-size: 1.2rem;
            min-height: 30px;
        }
        
        .correct {
            color: #00ff00;
        }
        
        .incorrect {
            color: #ff3300;
        }
        
        .progress-bar {
            height: 10px;
            background: rgba(0, 20, 0, 0.7);
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: #00ff00;
            width: 0%;
            transition: width 0.5s;
        }
        
        .terminal-text {
            color: #00aa00;
        }
        
        .highlight {
            background: rgba(0, 255, 0, 0.1);
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .scan-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background: rgba(0, 255, 0, 0.3);
            top: 0;
            left: 0;
            animation: scan 3s linear infinite;
            display: none;
        }
        
        @keyframes scan {
            0% { top: 0; }
            100% { top: 100%; }
        }
        
        .game-over, .start-screen {
            text-align: center;
            padding: 30px;
            background: rgba(0, 10, 0, 0.9);
            border: 1px solid #004400;
            border-radius: 5px;
            margin-top: 20px;
        }
        
        .final-score {
            font-size: 2rem;
            margin: 20px 0;
            color: #00ff00;
        }
        
        .hacker-rank {
            font-size: 1.5rem;
            margin: 20px 0;
            color: #00aa00;
        }
        
        .flashing {
            animation: flash 1s infinite;
        }
        
        @keyframes flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .tips {
            background: rgba(0, 20, 0, 0.5);
            padding: 15px;
            border: 1px solid #004400;
            border-radius: 5px;
            margin-top: 20px;
            font-size: 0.9rem;
            color: #00aa00;
        }
        
        .tip-title {
            color: #00ff00;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .start-screen {
            display: block;
        }
        
        .game-screen {
            display: none;
        }
        
        .game-title {
            font-size: 3rem;
            margin-bottom: 20px;
            text-shadow: 0 0 15px #00ff00;
        }
        
        .game-description {
            margin: 20px 0;
            line-height: 1.6;
            color: #00aa00;
	    text-align: left;
        }
        
        .start-btn {
            font-size: 1.5rem;
            padding: 15px 40px;
            margin-top: 20px;
            background: rgba(0, 40, 0, 0.8);
            border: 2px solid #00ff00;
        }
        
        .start-btn:hover {
            background: rgba(0, 60, 0, 0.8);
            box-shadow: 0 0 20px #00ff00;
        }
        
        .email-link {
            color: #00aaff;
            text-decoration: underline;
            cursor: pointer;
        }
        
        .email-link:hover {
            color: #00ccff;
        }
        
        .link-preview {
            position: absolute;
            background: rgba(0, 20, 0, 0.95);
            border: 1px solid #004400;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.9rem;
            z-index: 100;
            max-width: 400px;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>PHISHING EXPEDITION</h1>
            <div class="subtitle">PHISHING IDENTIFICATION TRAINING</div>
        </header>
        
        <!-- Start Screen -->
        <div class="start-screen" id="start-screen">
            <div class="game-description">
		<h2>MISSION BRIEFING</h2>
                <p>Welcome to Phishing Expedition, agent. Your mission is to identify phishing emails from legitimate ones.</p>
                <p>You'll have 60 seconds to identify as many emails as possible.</p>
                <p>Each correct identification earns you points. Be careful - wrong answers cost you lives!</p>
                <p><strong>Hover over links to see their actual destination!</strong></p>
            </div>
            <button class="start-btn" id="start-btn">START PHISHING EXPEDITION</button>
            
            <div class="tips">
                <div class="tip-title">PHISHING INDICATORS:</div>
                <div>• Urgent language and threats of account suspension</div>
                <div>• Generic greetings like "Dear Customer" instead of your name</div>
                <div>• Suspicious sender addresses that mimic legitimate companies</div>
                <div>• Requests for personal information or password verification</div>
                <div>• Poor grammar and spelling mistakes</div>
                <div>• Links that don't match the legitimate company's domain</div>
            </div>
        </div>
        
        <!-- Game Screen -->
        <div class="game-screen" id="game-screen">
            <div class="game-area">
                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-value" id="score">0</div>
                        <div class="stat-label">SCORE</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="level">1</div>
                        <div class="stat-label">LEVEL</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="lives">3</div>
                        <div class="stat-label">LIVES</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="time">60</div>
                        <div class="stat-label">TIME</div>
                    </div>
                </div>
                
                <div class="progress-bar">
                    <div class="progress" id="progress"></div>
                </div>
                
                <div class="email-container">
                    <div class="scan-line" id="scan-line"></div>
                    <div class="email-header">
                        <div class="email-subject" id="email-subject">SECURITY ALERT: Your Account Has Been Compromised</div>
                        <div class="email-from" id="email-from">From: security@yourbank.com</div>
                    </div>
                    <div class="email-body" id="email-body">
                        <p>Dear Valued Customer,</p>
                        <p>We've detected unusual activity on your account. For your security, we've temporarily limited access to your account.</p>
                        <p>To restore your account access, please <span class="highlight">click here</span> to verify your identity and update your security information.</p>
                        <p>If you do not take action within 24 hours, your account may be permanently suspended.</p>
                        <p>Sincerely,<br>Security Team</p>
                    </div>
                    <div class="email-footer" id="email-footer">
                        This message was sent to: user@emailprovider.com
                    </div>
                </div>
                
                <div class="result" id="result"></div>
                
                <div class="actions">
                    <button id="legit-btn">LEGITIMATE</button>
                    <button id="phish-btn">PHISHING</button>
                </div>
                
                <div class="tips">
                    <div class="tip-title">PHISHING INDICATORS:</div>
                    <div>• Urgent language and threats of account suspension</div>
                    <div>• Generic greetings like "Dear Customer" instead of your name</div>
                    <div>• Suspicious sender addresses that mimic legitimate companies</div>
                    <div>• Requests for personal information or password verification</div>
                    <div>• Poor grammar and spelling mistakes</div>
                    <div>• Links that don't match the legitimate company's domain</div>
                </div>
            </div>
            
            <div class="game-over" id="game-over">
                <h2>SESSION TERMINATED</h2>
                <div class="final-score">FINAL SCORE: <span id="final-score">0</span></div>
                <div class="hacker-rank" id="hacker-rank">RANK: SCRIPT KIDDIE</div>
                <button id="restart-btn">INITIATE NEW SESSION</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Game elements
            const startScreen = document.getElementById('start-screen');
            const gameScreen = document.getElementById('game-screen');
            const startBtn = document.getElementById('start-btn');
            const scoreElement = document.getElementById('score');
            const levelElement = document.getElementById('level');
            const livesElement = document.getElementById('lives');
            const timeElement = document.getElementById('time');
            const progressElement = document.getElementById('progress');
            const scanLine = document.getElementById('scan-line');
            const emailSubject = document.getElementById('email-subject');
            const emailFrom = document.getElementById('email-from');
            const emailBody = document.getElementById('email-body');
            const emailFooter = document.getElementById('email-footer');
            const resultElement = document.getElementById('result');
            const legitBtn = document.getElementById('legit-btn');
            const phishBtn = document.getElementById('phish-btn');
            const gameOverScreen = document.getElementById('game-over');
            const finalScoreElement = document.getElementById('final-score');
            const hackerRankElement = document.getElementById('hacker-rank');
            const restartBtn = document.getElementById('restart-btn');
            
            // Game state
            let score = 0;
            let level = 1;
            let lives = 3;
            let timeLeft = 60;
            let gameActive = false;
            let currentEmail = null;
            let timer;
            let usedEmailIndices = [];
            
            // Email database
            const emails = [
                // Level 1 - Basic phishing indicators
                {
                    subject: "Your Amazon Order Confirmation",
                    from: "no-reply@amazon.com",
                    body: `
                        <p>Hello Jane,</p>
                        <p>Thank you for your order! Your order #114-6920354-1234567 has been confirmed.</p>
                        <p>Expected delivery: Thursday, October 12</p>
                        <p>You can track your package <a href="#" class="email-link" data-url="https://www.amazon.com/gp/your-account/order-history">here</a>.</p>
                        <p>Thank you for shopping with Amazon!</p>
                    `,
                    footer: "Amazon.com, 410 Terry Ave N, Seattle, WA 98109",
                    isPhishing: false,
                    difficulty: 1
                },
                {
                    subject: "URGENT: Your PayPal Account Limited",
                    from: "service@paypal-security.com",
                    body: `
                        <p>Dear PayPal User,</p>
                        <p>We've detected suspicious activity on your PayPal account. To protect your account, we've temporarily limited access.</p>
                        <p>You must <span class="highlight">verify your account information</span> within 24 hours to avoid permanent suspension.</p>
                        <p>Click <a href="#" class="email-link" data-url="http://paypal-security-verify.com/login">here</a> to restore your account access now.</p>
                        <p>Sincerely,<br>PayPal Security Team</p>
                    `,
                    footer: "Please do not reply to this email",
                    isPhishing: true,
                    difficulty: 1
                },
                {
                    subject: "Netflix Payment Issue",
                    from: "info@netflix.com",
                    body: `
                        <p>Hello,</p>
                        <p>We're having trouble with your current billing information. We'll try again in 24 hours, but in the meantime you may experience interruption to your service.</p>
                        <p>To update your payment method, please visit your <a href="#" class="email-link" data-url="https://www.netflix.com/YourAccount">Account page</a>.</p>
                        <p>If you have any questions, please contact customer service.</p>
                        <p>- The Netflix Team</p>
                    `,
                    footer: "Netflix, 100 Winchester Circle, Los Gatos, CA 95032, USA",
                    isPhishing: false,
                    difficulty: 1
                },
                {
                    subject: "Apple ID Locked for Security Reasons",
                    from: "support@appleid.secure-service.com",
                    body: `
                        <p>Dear Apple User,</p>
                        <p>Your Apple ID has been locked for security reasons. We detected unusual activity that may indicate your account has been compromised.</p>
                        <p>To unlock your account, you must <span class="highlight">verify your identity</span> immediately.</p>
                        <p><a href="#" class="email-link" data-url="http://appleid-secure-service.com/verify">Click here to verify your Apple ID</a></p>
                        <p>Apple Support</p>
                    `,
                    footer: "Copyright © 2023 Apple Inc. All rights reserved.",
                    isPhishing: true,
                    difficulty: 1
                },
                
                // Level 2 - More subtle phishing attempts
                {
                    subject: "Microsoft Account Unusual Sign-In Activity",
                    from: "account-security-noreply@microsoft.com",
                    body: `
                        <p>Hi John,</p>
                        <p>We noticed a new sign-in to your Microsoft account on a Windows device. If this was you, you can disregard this message.</p>
                        <p>If this wasn't you, your account may have been compromised. Please <a href="#" class="email-link" data-url="https://account.live.com/activity">review your recent activity</a> and secure your account.</p>
                        <p>Thanks,<br>The Microsoft account team</p>
                    `,
                    footer: "Microsoft Corporation, One Microsoft Way, Redmond, WA 98052",
                    isPhishing: false,
                    difficulty: 2
                },
                {
                    subject: "Google: New sign-in from Windows device",
                    from: "google-noreply@accounts.google.com",
                    body: `
                        <p>Hi there,</p>
                        <p>A new sign-in from a Windows device was detected on your Google Account.</p>
                        <p>If this was you, you can ignore this alert. If you don't recognize this activity, please secure your account.</p>
                        <p>Check activity: <a href="#" class="email-link" data-url="https://myaccount.google.com/notifications">https://myaccount.google.com/notifications</a></p>
                        <p>Thanks,<br>The Google Accounts team</p>
                    `,
                    footer: "This email can't receive replies. For more information, visit the Google Accounts Help Center.",
                    isPhishing: false,
                    difficulty: 2
                },
                {
                    subject: "Your Facebook Friend Request",
                    from: "notification@facebookmail.com",
                    body: `
                        <p>You have a new friend request on Facebook.</p>
                        <p>David Smith sent you a friend request.</p>
                        <p>To confirm this friend request, follow the link below:</p>
                        <p><a href="#" class="email-link" data-url="https://www.facebook.com/friends/request">https://www.facebook.com/friends/request</a></p>
                        <p>Thanks,<br>The Facebook Team</p>
                    `,
                    footer: "Facebook, 1 Hacker Way, Menlo Park, CA 94025",
                    isPhishing: false,
                    difficulty: 2
                },
                {
                    subject: "Facebook: Confirm Your Friend Request",
                    from: "notification@face-book.com",
                    body: `
                        <p>You have a new friend request on Facebook.</p>
                        <p>Sarah Johnson sent you a friend request.</p>
                        <p>To confirm this friend request, follow the link below:</p>
                        <p><a href="#" class="email-link" data-url="http://fa.ce-book.com/friends/confirm">https://www.facebook.com/friends/confirm</a></p>
                        <p>Thanks,<br>The Facebook Team</p>
                    `,
                    footer: "Facebook, 1 Hacker Way, Menlo Park, CA 94025",
                    isPhishing: true,
                    difficulty: 2
                },
                
                // Level 3 - Advanced phishing with subtle domain spoofing
                {
                    subject: "Bank of America: Security Alert",
                    from: "alerts@bankofamerica.com",
                    body: `
                        <p>Dear Bank of America Customer,</p>
                        <p>We've detected a login to your Bank of America account from a new device.</p>
                        <p>If this was you, you don't need to do anything. If this wasn't you, please secure your account immediately.</p>
                        <p><a href="#" class="email-link" data-url="https://www.bankofamerica.com/security-center/">Click here to review account activity</a></p>
                        <p>Sincerely,<br>Bank of America Security Center</p>
                    `,
                    footer: "Please do not reply to this message",
                    isPhishing: false,
                    difficulty: 3
                },
                {
                    subject: "Bank of America: Security Alert",
                    from: "alerts@bankofamerica.security.com",
                    body: `
                        <p>Dear Bank of America Customer,</p>
                        <p>We've detected a login to your Bank of America account from a new device.</p>
                        <p>If this was you, you don't need to do anything. If this wasn't you, please <span class="highlight">secure your account immediately</span>.</p>
                        <p><a href="#" class="email-link" data-url="http://bankofamerica.security-verify.com/login">Click here to verify your account</a></p>
                        <p>Sincerely,<br>Bank of America Security Center</p>
                    `,
                    footer: "Please do not reply to this message",
                    isPhishing: true,
                    difficulty: 3
                },
                {
                    subject: "Microsoft: Action Required on Your Account",
                    from: "microsoft.support@micros0ft.com",
                    body: `
                        <p>Dear Microsoft User,</p>
                        <p>We've noticed unusual activity in your Microsoft account. To protect your account, we need you to verify your identity.</p>
                        <p>Please click the link below to complete the verification process:</p>
                        <p><a href="#" class="email-link" data-url="http://micros0ft-support.com/verify">Verify Your Microsoft Account</a></p>
                        <p>If you don't verify your account within 48 hours, your account will be suspended.</p>
                        <p>Thank you,<br>Microsoft Support Team</p>
                    `,
                    footer: "Microsoft Corporation, One Microsoft Way, Redmond, WA 98052",
                    isPhishing: true,
                    difficulty: 3
                },
                {
                    subject: "LinkedIn: You have a new connection request",
                    from: "linkedin@e.linkedin.com",
                    body: `
                        <p>Hi there,</p>
                        <p>You have a new connection request from Jennifer Martinez, Recruiter at Tech Solutions Inc.</p>
                        <p>To view this request and respond, visit your LinkedIn inbox:</p>
                        <p><a href="#" class="email-link" data-url="https://www.linkedin.com/inbox">https://www.linkedin.com/inbox</a></p>
                        <p>Best,<br>The LinkedIn Team</p>
                    `,
                    footer: "This email was intended for John Smith. © 2023 LinkedIn Corporation, 1000 W Maude Avenue, Sunnyvale, CA 94085.",
                    isPhishing: false,
                    difficulty: 3
                },
                
                // Level 4 - Very subtle phishing attempts
                {
                    subject: "Twitter: Login Verification Code",
                    from: "info@twitter.com",
                    body: `
                        <p>Hi John,</p>
                        <p>Your Twitter verification code is: 849327</p>
                        <p>Enter this code to complete your login. This code will expire in 20 minutes.</p>
                        <p>If you didn't request this code, you can safely ignore this email or <a href="#" class="email-link" data-url="https://help.twitter.com/security">learn more</a> about keeping your account secure.</p>
                        <p>Thanks,<br>The Twitter Team</p>
                    `,
                    footer: "This email was sent by Twitter, Inc. 1355 Market Street, Suite 900, San Francisco, CA 94103",
                    isPhishing: false,
                    difficulty: 4
                },
                {
                    subject: "Twitter: Login Verification Code",
                    from: "info@twltter.com",
                    body: `
                        <p>Hi John,</p>
                        <p>Your Twitter verification code is: 736491</p>
                        <p>Enter this code to complete your login. This code will expire in 20 minutes.</p>
                        <p>If you didn't request this code, you can safely ignore this email or <a href="#" class="email-link" data-url="http://twltter-help.com/security">learn more</a> about keeping your account secure.</p>
                        <p>Thanks,<br>The Twitter Team</p>
                    `,
                    footer: "This email was sent by Twitter, Inc. 1355 Market Street, Suite 900, San Francisco, CA 94103",
                    isPhishing: true,
                    difficulty: 4
                },
                {
                    subject: "Instagram: New Login to Your Account",
                    from: "security@mail.instagram.com",
                    body: `
                        <p>Hi Jane,</p>
                        <p>We noticed a new login to your Instagram account from Chrome on Windows.</p>
                        <p>If this was you, you can disregard this message. If this wasn't you, we recommend you <a href="#" class="email-link" data-url="https://www.instagram.com/accounts/password/change/">change your password</a> immediately.</p>
                        <p>The Instagram Team</p>
                    `,
                    footer: "Instagram, 1 Hacker Way, Menlo Park, CA 94025",
                    isPhishing: false,
                    difficulty: 4
                },
                {
                    subject: "Instagram: New Login to Your Account",
                    from: "security@instagram.help.com",
                    body: `
                        <p>Hi Jane,</p>
                        <p>We noticed a new login to your Instagram account from Chrome on Windows.</p>
                        <p>If this was you, you can disregard this message. If this wasn't you, we recommend you <a href="#" class="email-link" data-url="http://instagram.help-secure.com/password">change your password</a> immediately.</p>
                        <p>The Instagram Team</p>
                    `,
                    footer: "Instagram, 1 Hacker Way, Menlo Park, CA 94025",
                    isPhishing: true,
                    difficulty: 4
                },
                {
                    subject: "eBay: Your item has sold!",
                    from: "ebay@ebay.com",
                    body: `
                        <p>Congratulations! Your item has sold.</p>
                        <p>Your PlayStation 5 has sold for $450.00.</p>
                        <p>Please ship the item within 3 business days to complete the sale.</p>
                        <p>View sale details and print a shipping label: <a href="#" class="email-link" data-url="https://k2b-bulk.ebay.com/ws/eBayISAPI.dll?PrintShippingLabel">Print Shipping Label</a></p>
                        <p>Thank you for selling on eBay!</p>
                    `,
                    footer: "eBay Inc, 2025 Hamilton Avenue, San Jose, CA 95125",
                    isPhishing: false,
                    difficulty: 4
                },
                {
                    subject: "eBay: Your item has sold!",
                    from: "ebay@ebay-secure.com",
                    body: `
                        <p>Congratulations! Your item has sold.</p>
                        <p>Your iPhone 14 Pro has sold for $750.00.</p>
                        <p>Please confirm your payment details to receive your funds.</p>
                        <p>View sale details and confirm payment: <a href="#" class="email-link" data-url="http://ebay-secure-payment.com/confirm">Confirm Payment Details</a></p>
                        <p>Thank you for selling on eBay!</p>
                    `,
                    footer: "eBay Inc, 2025 Hamilton Avenue, San Jose, CA 95125",
                    isPhishing: true,
                    difficulty: 4
                }
            ];
            
            // Start game when button is clicked
            startBtn.addEventListener('click', function() {
                startScreen.style.display = 'none';
                gameScreen.style.display = 'block';
                initGame();
            });
            
            // Initialize game
            function initGame() {
                score = 0;
                level = 1;
                lives = 3;
                timeLeft = 60;
                gameActive = true;
                usedEmailIndices = [];
                
                scoreElement.textContent = score;
                levelElement.textContent = level;
                livesElement.textContent = lives;
                timeElement.textContent = timeLeft;
                progressElement.style.width = '0%';
                
                gameOverScreen.style.display = 'none';
                resultElement.textContent = '';
                
                loadRandomEmail();
                startTimer();
            }
            
            // Load a random email
            function loadRandomEmail() {
                // Filter emails by current level and exclude used ones
                const availableEmails = emails.filter((email, index) => 
                    email.difficulty <= level && !usedEmailIndices.includes(index)
                );
                
                // If no emails available for current level, use any unused email
                if (availableEmails.length === 0) {
                    const allUnused = emails.filter((email, index) => 
                        !usedEmailIndices.includes(index)
                    );
                    
                    if (allUnused.length === 0) {
                        // All emails used, reset used list
                        usedEmailIndices = [];
                        loadRandomEmail();
                        return;
                    }
                    
                    const randomIndex = Math.floor(Math.random() * allUnused.length);
                    currentEmail = allUnused[randomIndex];
                    
                    // Find the original index
                    const originalIndex = emails.findIndex(email => email === currentEmail);
                    usedEmailIndices.push(originalIndex);
                } else {
                    const randomIndex = Math.floor(Math.random() * availableEmails.length);
                    currentEmail = availableEmails[randomIndex];
                    
                    // Find the original index
                    const originalIndex = emails.findIndex(email => email === currentEmail);
                    usedEmailIndices.push(originalIndex);
                }
                
                emailSubject.textContent = currentEmail.subject;
                emailFrom.textContent = `From: ${currentEmail.from}`;
                emailBody.innerHTML = currentEmail.body;
                emailFooter.textContent = currentEmail.footer;
                
                // Add link preview functionality
                const links = emailBody.querySelectorAll('.email-link');
                links.forEach(link => {
                    link.addEventListener('mouseover', showLinkPreview);
                    link.addEventListener('mouseout', hideLinkPreview);
                });
                
                // Show scanning animation
                scanLine.style.display = 'block';
                setTimeout(() => {
                    scanLine.style.display = 'none';
                }, 3000);
            }
            
            // Show link preview
            function showLinkPreview(e) {
                const url = e.target.getAttribute('data-url');
                const preview = document.createElement('div');
                preview.className = 'link-preview';
                preview.textContent = `Link destination: ${url}`;
                preview.style.left = `${e.pageX + 10}px`;
                preview.style.top = `${e.pageY + 10}px`;
                preview.id = 'link-preview';
                document.body.appendChild(preview);
            }
            
            // Hide link preview
            function hideLinkPreview() {
                const preview = document.getElementById('link-preview');
                if (preview) {
                    preview.remove();
                }
            }
            
            // Start the game timer
            function startTimer() {
                clearInterval(timer);
                timer = setInterval(() => {
                    if (gameActive) {
                        timeLeft--;
                        timeElement.textContent = timeLeft;
                        progressElement.style.width = `${(60 - timeLeft) / 60 * 100}%`;
                        
                        if (timeLeft <= 0) {
                            endGame();
                        }
                    }
                }, 1000);
            }
            
            // Handle user choice
            function handleChoice(userChoice) {
                if (!gameActive) return;
                
                const isPhishing = currentEmail.isPhishing;
                let isCorrect = false;
                
                if ((userChoice === 'phish' && isPhishing) || 
                    (userChoice === 'legit' && !isPhishing)) {
                    // Correct choice
                    isCorrect = true;
                    score += 10 * level;
                    scoreElement.textContent = score;
                    resultElement.textContent = 'CORRECT - PHISHING ATTACK IDENTIFIED';
                    resultElement.className = 'result correct';
                    
                    // Level up every 50 points
                    if (score >= level * 50) {
                        level++;
                        levelElement.textContent = level;
                        resultElement.textContent = 'LEVEL UP! INCREASING DIFFICULTY';
                        timeLeft += 10; // Bonus time
                    }
                } else {
                    // Incorrect choice
                    lives--;
                    livesElement.textContent = lives;
                    resultElement.textContent = isPhishing ? 
                        'INCORRECT - THAT WAS A PHISHING EMAIL' : 
                        'INCORRECT - THAT EMAIL WAS LEGITIMATE';
                    resultElement.className = 'result incorrect';
                    
                    if (lives <= 0) {
                        endGame();
                        return;
                    }
                }
                
                // Flash the result
                resultElement.classList.add('flashing');
                setTimeout(() => {
                    resultElement.classList.remove('flashing');
                }, 1000);
                
                // Load next email after a delay
                setTimeout(() => {
                    if (gameActive) {
                        loadRandomEmail();
                        resultElement.textContent = '';
                    }
                }, 2000);
            }
            
            // End the game
            function endGame() {
                gameActive = false;
                clearInterval(timer);
                
                finalScoreElement.textContent = score;
                
                // Determine hacker rank
                let rank = "SCRIPT KIDDIE";
                if (score >= 200) rank = "ELITE HACKER";
                else if (score >= 150) rank = "SECURITY ANALYST";
                else if (score >= 100) rank = "PENTESTER";
                else if (score >= 50) rank = "CYBER APPRENTICE";
                
                hackerRankElement.textContent = `RANK: ${rank}`;
                gameOverScreen.style.display = 'block';
            }
            
            // Event listeners
            legitBtn.addEventListener('click', () => handleChoice('legit'));
            phishBtn.addEventListener('click', () => handleChoice('phish'));
            restartBtn.addEventListener('click', function() {
                gameOverScreen.style.display = 'none';
                initGame();
            });
        });
    </script>
</body>
</html>
